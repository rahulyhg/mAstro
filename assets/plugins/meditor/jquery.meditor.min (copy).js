$(function(){$.getScript(PLUGINS+"/meditor/caret/dist/jquery.caret.min.js")});(function(e){e.fn.meditor=function(t){var n=e.extend({fonts:["Arial","Comic Sans MS","Courier New","Lato","Monotype Corsiva","Tahoma","Times"]},t);return this.each(function(t){var n=e(this).addClass("hidden-textarea");var r=n.val();var i;if(n.attr("id"))i=n.attr("id");else i="";heit=n.attr("style").split("height:")[1].split("px")[0];var s=e("<div/>",{id:i,"class":"meditor-container sceditor-container form-controls",style:"min-height:"+heit+"px"});n.after(s);s.show();var o=e("<div />",{"class":"meditor-iframe",id:"meditor",contenteditable:true,html:r}).appendTo(s);var u=e("<div/>",{"class":"meditor-link-thumbbox hide"}).appendTo(s);$editorBody=s.find(".meditor-iframe");$editorBody.addClass("form-controls").show();s.resizable({handles:"s",stop:function(e,t){var n=t.size.width;var r=t.size.height;s.find(".meditor-iframe").height(t.size.height)}});$editorBody.on("keyup",function(t){var r=[8,17,33,34,35,36,37,38,39,40];n.val(e(this).html());var i=/@/ig;var o=/@(\w+)/ig;var u=/@.*(\s)/ig;var a=e(this).text();var f=a.match(i);var l=a.match(o);var c=a.match(u);var h="key="+l;if(f.length>0&&f!=null){topp=parseInt(e(this).caret("position").top)+25;if(!s.find(".select-tag-users").length)e(this).after('<div class="select-tag-users" style="position: absolute; top: '+topp+'px"><a class="select-tag-close fa fa-times"></a> <div class="content"><div class="spinner"> <div></div> <div></div> <div></div> </div></div></div>');s.find(".select-tag-users").slideDown("show").find(".select-tag-close").click(function(){e(this).closest(".select-tag-users").remove()});s.find(".select-tag-users .content").html("Tag someone...");if(c!=null)s.find(".select-tag-users").remove();else if(l.length>0){e.ajax({type:"POST",url:MAIN_URL+"/pages/friendList.php",data:h,cache:false,success:function(t){s.find(".select-tag-users .content").html(t).show();s.find(".select-tag-users .one-fr-search").on("click",function(){ebody=s.find(".meditor-iframe");var t=e(this).attr("alt");var n=ebody.html();var r=n.replace(o," ");ebody.html(r+'<span>&nbsp;</span><span class="tag-name" contenteditable="false">+'+t+" </span><span>&nbsp;</span>");s.find(".select-tag-users").remove()})}})}}else e(".select-tag-users").remove()}).bind("paste",function(t){var n=t.originalEvent.clipboardData.getData("text");newLink=findLink(n);if(newLink){s.find(".meditor-link-thumbbox").show().html('<div class="spinner"><div></div> <div></div> <div></div></div>');setTimeout(function(){previewImg="preview.jpg";s.addClass("with-thumbbox").css("height",200).find(".meditor-link-thumbbox").html('<div class="thumbbox"><a class="close-thumbbox right"><span class="fa fa-times"></span></a> <input type="hidden" name="thumb-link" value="'+link+'"/> <input type="hidden" name="thumb-link-title"/> <input type="hidden" name="thumb-link-img"/> <textarea class="hide non-sce" name="thumb-link-content"></textarea> <div class="left thumb-photo hide"></div> <div class="thumb-title"><a href="'+link+'"></a></div> <div class="thumb-link"><a href="'+link+'">'+newLink+'</a></div> <div class="thumb-content"><a href="'+link+'"></a></div></div>');e(".close-thumbbox").click(function(){e(this).closest(".meditor-container").removeClass("with-thumbbox").css("height",120).find(".meditor-link-thumbbox").slideUp(200,function(){e(this).html("").find(".thumb-link").val("")})});e.ajax({url:newLink,success:function(t){s.find(".meditor-link-thumbbox .thumb-photo").show().load(newLink+" img:first",function(){e('[name="thumb-link-img"]').val(e(this).find("img").attr("src"))});title=e(t).filter("title").text();s.find(".meditor-link-thumbbox .thumb-title a").html(title);e('[name="thumb-link-title"]').val(title);s.find(".meditor-link-thumbbox .thumb-content a").load(newLink+" body > div:first",function(){e('[name="thumb-link-content"]').val(e(this).text())})},error:function(){s.find(".meditor-link-thumbbox .thumb-photo").hide()}})},300)}})})}})(jQuery)
